<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Happy Birthday</title>
    <style>
      
      .personal-greeting {
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2em;
        color: #fff;
        background: #ff69b4;
        padding: 10px 25px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
        z-index: 1002;
        animation: bounce 1s infinite alternate;
      }

      .quote-card {
        position: fixed;
        top: 30%;
        left: 5%;
        width: 250px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        font-size: 1em;
        font-style: italic;
        color: #333;
      }

      @keyframes floatGift {
        0% { top: 0; opacity: 1; }
        100% { top: 100vh; opacity: 0; }
      }
      body {
        margin: 0;
        background: #2c3e50;
        overflow: hidden;
        font-family: sans-serif;
      }

      .fancy-cake {
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        width: 180px;
        z-index: 5;
      }

      .plate {
        width: 220px;
        height: 20px;
        background: #ccc;
        border-radius: 10px;
        margin: 0 auto 5px;
      }

      .cake-layer {
        width: 100%;
        height: 40px;
        margin: 0 auto;
        border-radius: 10px;
        box-shadow: inset 0 2px 4px rgba(255,255,255,0.3);
      }

      .bottom-layer {
        background: #ffadad;
      }

      .middle-layer {
        background: #ffd6a5;
        margin-top: -10px;
      }

      .top-layer {
        background: #caffbf;
        margin-top: -10px;
      }

      .icing {
        height: 15px;
        background: white;
        border-radius: 10px 10px 0 0;
        margin-top: -5px;
        box-shadow: 0 5px 5px rgba(0,0,0,0.1);
      }

      .drip {
        position: absolute;
        bottom: 0;
        width: 10px;
        height: 20px;
        background: white;
        border-radius: 0 0 10px 10px;
        animation: dripWave 2s ease-in-out infinite;
      }

      @keyframes dripWave {
        0% { transform: scaleY(1); }
        50% { transform: scaleY(1.3); }
        100% { transform: scaleY(1); }
      }

      .candles {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: -20px;
      }

      .candle {
        width: 8px;
        height: 30px;
        background: #fff;
        border-radius: 2px;
        position: relative;
      }

      .flame {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        width: 8px;
        height: 10px;
        background: gold;
        border-radius: 50%;
        animation: flicker 0.2s infinite alternate;
      }

      @keyframes flicker {
        0% {
          transform: translateX(-50%) scale(1);
          opacity: 1;
        }
        100% {
          transform: translateX(-50%) scale(1.2);
          opacity: 0.7;
        }
      }

      .snowflake {
        position: fixed;
        top: -10px;
        color: white;
        font-size: 18px;
        user-select: none;
        pointer-events: none;
        animation: fall linear infinite;
      }

      @keyframes fall {
        0% {
          transform: translate(-20vh, -10vh) rotate(0deg);
        }
        30% {
          transform: translate(25vh, 0) rotate(180deg);
        }
        100% {
          transform: translate(5vh, 100vh) rotate(360deg);
        }
      }

      .balloon-pop {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: sparkle 1s ease-out forwards;
      }

      .balloon {
        position: absolute;
        bottom: -50px;
        border-radius: 50%;
        opacity: 0.9;
        z-index: 999;
        animation: floatUp 8s linear forwards, drift 3s ease-in-out infinite;
      }

      .balloon::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 2px;
        height: 80px;
        background: white;
        animation: waveThread 1s ease-in-out infinite alternate;
      }

      @keyframes floatUp {
        0% {
          transform: translateY(0);
          opacity: 1;
        }
        100% {
          transform: translateY(-120vh);
          opacity: 0;
        }
      }

      @keyframes waveThread {
        0% {
          transform: translateX(-50%) rotate(-5deg);
        }
        100% {
          transform: translateX(-50%) rotate(5deg);
        }
      }

      .sparkle {
        position: absolute;
        font-size: 30px;
        color: gold;
        opacity: 0.8;
        animation: sparkleAnimation 1s ease-out forwards;
        pointer-events: none;
      }

      @keyframes sparkleAnimation {
        from {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
        to {
          transform: translate(-50px, -50px) scale(2);
          opacity: 0;
        }
      }

      .happy-banner {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        z-index: 1001;
      }

      .happy-banner .banner-text {
        font-family: "Comic Sans MS", cursive, sans-serif;
        font-size: 2.5em;
        font-weight: bold;
        color: #fff;
        padding: 10px 20px;
        border-radius: 15px;
        line-height: 1.2;
        display: inline-block;
        text-shadow: 1px 1px 2px black;
        animation: bounce 1s infinite alternate;
        margin: 0 5px;
        position: relative;
        overflow: hidden;
        cursor: pointer;
      }

      .happy-banner .string {
        position: absolute;
        width: 2px;
        height: 40px;
        background: #333;
        top: -40px;
      }

      .happy-banner .string.left {
        left: 20%;
      }

      .happy-banner .string.right {
        right: 20%;
      }

      .firefly {
        position: absolute;
        width: 5px;
        height: 5px;
        background-color: yellow;
        border-radius: 50%;
        opacity: 0;
        box-shadow: 0 0 10px 2px yellow;
        animation: fadeBlink 3s infinite alternate ease-in-out,
          moveRandomly 10s infinite linear;
      }

      @keyframes fadeBlink {
        0%,
        100% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
      }

      @keyframes moveRandomly {
        from {
          transform: translate(0, 0);
        }
        to {
          transform: translate(-50px, 50px) rotate(360deg);
        }
      }

      .firework {
        position: absolute;
        width: 5px;
        height: 5px;
        border-radius: 50%;
        animation: launch 1s ease-out forwards, explode 2s 1s forwards;
      }

      .spark {
        position: absolute;
        width: 3px;
        height: 3px;
        border-radius: 50%;
        opacity: 0;
        animation: sparkleEffect 2s linear forwards;
      }

      @keyframes launch {
        to {
          transform: translateY(-300vh);
        }
      }

      @keyframes explode {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        100% {
          transform: scale(10);
          opacity: 0;
        }
      }

      @keyframes sparkleEffect {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0;
          transform: scale(0.2) translate(var(--x), var(--y));
        }
      }

      .confetti {
        position: fixed;
        z-index: 999;
        pointer-events: none;
      }

      .birthday-banner {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 300px;
        z-index: 1002;
        pointer-events: none;
        animation: bannerWave 3s ease-in-out infinite;
      }

      @keyframes bannerWave {
        0% { transform: translateX(-50%) rotate(-2deg); }
        50% { transform: translateX(-50%) rotate(2deg); }
        100% { transform: translateX(-50%) rotate(-2deg); }
      }
      
      .personal-name-banner {
        position: fixed;
        top: 25vh;
        left: 50%;
        transform: translateX(-50%);
        font-size: 4em;
        font-weight: bold;
        color: transparent;
        background: linear-gradient(to right, #ff5252, #ffd740, #4fc3f7, #ba68c8);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        padding: 10px 25px;
        border-radius: 12px;
        z-index: 1002;
        animation: bannerWave 3s ease-in-out infinite;
        text-shadow: none;
        font-family: "Comic Sans MS", cursive, sans-serif;
        align-content: center;
      }

      @media (max-width: 480px) {
        .personal-greeting {
          font-size: 1.2em;
          padding: 6px 15px;
        }

        .quote-card {
          width: 90%;
          left: 5%;
          font-size: 0.9em;
        }

        .happy-banner .banner-text {
          font-size: 1.6em;
          padding: 5px 10px;
        }

        .cake-layer {
          height: 30px;
        }

        .candles {
          gap: 5px;
        }

        .candle {
          height: 20px;
        }
      }

    </style>
  </head>
  <body>
    
    <img src="./banner.png" alt="Happy Birthday" class="birthday-banner" />
    <div class="personal-name-banner"> <span id="nameField">Friend</span> </div>

    <script>
      const colors = ["#ff4d4d", "#4da6ff", "#33cc33", "#ffcc00", "#cc66ff"];
      const snowCount = 40;

      function createSnowflakes() {
        Array.from({ length: snowCount }, () => {
          const snow = document.createElement("div");
          snow.className = "snowflake";
          snow.style.left = Math.random() * 100 + "vw";
          snow.style.animationDuration = Math.random() * 4 + 5 + "s"; // slower snow
          snow.style.fontSize = "18px";
          snow.style.opacity = Math.random();
          snow.innerText = "â„";
          document.body.appendChild(snow);
        });
      }

      function randomColor() {
        return colors[Math.floor(Math.random() * colors.length)];
      }

      function randomPosition() {
        return Math.random() * 100;
      }
      
      function createSpark(x, y, color) {
        const spark = document.createElement("div");
        spark.className = "spark";
        //spark.textContent = "âœ¨"; // Sparkle emoji
        spark.style.backgroundColor = color;
        spark.style.left = `${x}vw`;
        spark.style.top = `${y}vh`;
        spark.style.scale = Math.random() * 2 + 2;

        const angle = Math.random() * 4 * Math.PI;
        const radius = Math.random() * 35;

        spark.style.setProperty("--x", `${Math.cos(angle) * radius}vw`);
        spark.style.setProperty("--y", `${Math.sin(angle) * radius}vh`);

        document.body.appendChild(spark);

        spark.addEventListener("animationend", () => spark.remove());
      }

      function launchFirework() {
        const firework = document.createElement("div");
        const color = randomColor();
        firework.className = "firework";
        firework.style.textContent = "â„"; // Firework emoji
        firework.style.fontSize = `${Math.random() * 10 + 30}px`;
        firework.style.backgroundColor = color;
        firework.style.boxShadow = `0 0 20px ${color}`;
        firework.style.left = `${randomPosition()}vw`;
        firework.style.bottom = `${15 + Math.random() * 30}vh`; // Pops between 15%â€“45% height

        document.body.appendChild(firework);

        firework.addEventListener("animationend", () => {
          for (let i = 0; i < 30; i++) {
            // Emit multiple sparks
            createSpark(
              parseFloat(firework.style.left),
              parseFloat(firework.style.bottom),
              color
            );
          }
          firework.remove();
        });
      }

      let activePops = [];

      function spawnBalloon() {
        const balloon = document.createElement("div");
        balloon.className = "balloon";

        const color = randomColor();
        const size = 30 + Math.random() * 30;
        balloon.style.backgroundColor = color;
        balloon.style.width = `${size}px`;
        balloon.style.height = `${size * 1.3}px`;
        balloon.style.left = `${Math.random() * 100}vw`;

        document.body.appendChild(balloon);

        setTimeout(() => {
          if (Math.random() < 0.3) { // 30% chance to pop
            // Pop at a random position instead of balloon center
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight * 0.5;
            createPop(x, y, color);
            balloon.remove();
          } else {
            balloon.remove();
          }
        }, 8000);

        balloon.addEventListener("click", (e) => {
          e.target.remove();
          createPop(e.clientX, e.clientY, color);
        });

        // Mobile touch support for balloon pops
        balloon.addEventListener(
          "touchstart",
          (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            balloon.remove();
            createPop(touch.clientX, touch.clientY, color);
          },
          { passive: false }
        );
      }

      function createPop(x, y, color) {
        Array.from({ length: 10 }, () => {
          const pop = document.createElement("div");
          pop.className = "pop";
          pop.textContent = "â„";
          pop.style.color = color;

          // Generate offsets for random positioning
          const offsetX = Math.random() * 100 - 50;
          const offsetY = Math.random() * 100 - 50;

          // Style the pop element with absolute positioning
          pop.style.position = "absolute";
          pop.style.left = `${x}px`;
          pop.style.top = `${y}px`;

          // Apply a random scale transformation
          pop.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${
            0.8 + Math.random()
          })`;

          document.body.appendChild(pop);

          animatePop(pop);

          // Remove the pop after 1 second
          setTimeout(() => pop.remove(), 1000);
        });
        // Add a random message near the pop
        const messages = ["You are amazing!", "Smile, it's your day!", "Keep shining!", "Wishing you joy!"];
        if (Math.random() < 0.3) {
          const msg = document.createElement("div");
          msg.textContent = messages[Math.floor(Math.random() * messages.length)];
          msg.style.position = "absolute";
          msg.style.left = x + "px";
          msg.style.top = (y - 30) + "px";
          msg.style.color = color;
          msg.style.fontSize = "14px";
          msg.style.fontWeight = "bold";
          msg.style.zIndex = 9999;
          msg.style.textShadow = "0 0 5px #000";
          document.body.appendChild(msg);
          setTimeout(() => msg.remove(), 2000);
        }
      }

      function animatePop(pop) {
        const driftX = (Math.random() - 0.5) * 2; // Random horizontal drift
        const driftY = -(1 + Math.random()); // Upward vertical drift

        let posX = parseFloat(pop.style.left);
        let posY = parseFloat(pop.style.top);

        const animationInterval = setInterval(() => {
          posX += driftX;
          posY += driftY;

          pop.style.left = `${posX}px`;
          pop.style.top = `${posY}px`;

          if (
            posY < -10 ||
            posX < -10 ||
            posX > window.innerWidth + 10 ||
            posY > window.innerHeight + 10
          ) {
            clearInterval(animationInterval);
            pop.remove();
          }
        }, 50);
      }

      function lightCandles() {
        document.querySelectorAll(".flame").forEach(f => f.classList.remove("hidden"));
        
        const msg = new SpeechSynthesisUtterance(
          "Happy Birthday! Wishing you a wonderful year filled with love, joy, peace."
        );
        msg.lang = "en-US";
        speechSynthesis.speak(msg);

        // Party emoji burst
        for (let i = 0; i < 20; i++) {
          const emoji = document.createElement("div");
          emoji.className = "pop";
          emoji.textContent = "ðŸ¥³";
          emoji.style.position = "absolute";
          emoji.style.left = Math.random() * window.innerWidth + "px";
          emoji.style.top = "60%";
          emoji.style.fontSize = "24px";
          emoji.style.opacity = "1";
          document.body.appendChild(emoji);

          animatePop(emoji);
          setTimeout(() => emoji.remove(), 1500);
        }
      }

      function spawnFireflySwarm() {
        const swarmSize = 5;

        Array.from({ length: swarmSize }, () => {
          const firefly = document.createElement("div");
          firefly.className = "firefly";

          const duration = 5 + Math.random() * 3;
          firefly.style.animationDuration = `${duration}s, ${
            10 + Math.random() * 5
          }s`;

          firefly.style.width = `${3 + Math.random() * 4}px`;
          firefly.style.height = firefly.style.width;

          const x = randomPosition();
          const y = randomPosition();

          firefly.style.left = `${x}vw`;
          firefly.style.top = `${y}vh`;

          document.body.appendChild(firefly);

          setTimeout(() => firefly.remove(), duration * 2000);
        });
      }
      
      let mouseFireflyCooldown = false;
      document.addEventListener("mousemove", (e) => {
        if (mouseFireflyCooldown) return;
        mouseFireflyCooldown = true;

        const firefly = document.createElement("div");
        firefly.className = "firefly";
        firefly.style.left = e.pageX + "px";
        firefly.style.top = e.pageY + "px";
        document.body.appendChild(firefly);
        setTimeout(() => firefly.remove(), 4000);

        setTimeout(() => {
          mouseFireflyCooldown = false;
        }, 300); // throttle fireflies to one every 300ms
      });

      let confettiFired = false;
      window.addEventListener("click", () => {
        if (!confettiFired) {
          confettiFired = true;
          for (let i = 0; i < 200; i++) {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = `${Math.random() * 100}vw`;
            confetti.style.animationDelay = `${Math.random() * 2}s`;
            confetti.style.backgroundColor = randomColor();
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 4000);
          }
        }
      });
      
      function randomInterval(min, max) {
        return Math.random() * (max - min) + min;
      }

      function startFireflies() {
        setInterval(spawnFireflySwarm, randomInterval(4000, 7000));
      }

      // Initialize animations
      function dropGiftBox() {
        const gift = document.createElement("div");
        gift.textContent = "ðŸŽ";
        gift.style.position = "absolute";
        gift.style.left = `${Math.random() * 100}vw`;
        gift.style.top = "0px";
        gift.style.fontSize = "30px";
        gift.style.animation = "floatGift 10s linear forwards";
        gift.style.zIndex = 1006;
        gift.style.cursor = "pointer";

        gift.addEventListener("click", () => {
          alert("âœ¨ Surprise! Your presence makes the world better.");
          gift.remove();
        });

        document.body.appendChild(gift);
        setTimeout(() => gift.remove(), 5000);
      }

      window.onload = () => {
        startFireflies();
        createSnowflakes();
        setInterval(spawnBalloon, 1000);
        setInterval(launchFirework, 2000);

        const intro = new SpeechSynthesisUtterance("Hey Priya! This day is just for you. Here's something magical. Enjoy!");
        intro.lang = 'en-US';
        //setTimeout(() => speechSynthesis.speak(intro), 2000);

        setInterval(() => {
          if (Math.random() < 0.2) dropGiftBox();
        }, 60000);

        // Parse query parameter for name and update nameField and intro message
        const urlParams = new URLSearchParams(window.location.search);
        const nameFromUrl = urlParams.get('name');
        const name = nameFromUrl ? nameFromUrl : "Friend";
        document.getElementById('nameField').textContent = name;
        intro.text = `Hey ${name}! This day is just for you. Here's something magical. Enjoy!`;
      };
    </script>
  </body>
</html>
